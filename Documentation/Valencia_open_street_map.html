<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Pablo Leon">
<meta name="dcterms.date" content="2023-03-14">

<title>City maps using OpenStreetMap R package</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="Valencia_open_street_map_files/libs/clipboard/clipboard.min.js"></script>
<script src="Valencia_open_street_map_files/libs/quarto-html/quarto.js"></script>
<script src="Valencia_open_street_map_files/libs/quarto-html/popper.min.js"></script>
<script src="Valencia_open_street_map_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Valencia_open_street_map_files/libs/quarto-html/anchor.min.js"></script>
<link href="Valencia_open_street_map_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Valencia_open_street_map_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Valencia_open_street_map_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Valencia_open_street_map_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Valencia_open_street_map_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#creating-city-maps-using-osmdata-package" id="toc-creating-city-maps-using-osmdata-package" class="nav-link active" data-scroll-target="#creating-city-maps-using-osmdata-package">Creating city maps using <strong>osmdata</strong> package</a></li>
  <li><a href="#working-with-vector-data" id="toc-working-with-vector-data" class="nav-link" data-scroll-target="#working-with-vector-data">Working with vector data</a></li>
  <li><a href="#install-and-load-osmdata-package-from-cran" id="toc-install-and-load-osmdata-package-from-cran" class="nav-link" data-scroll-target="#install-and-load-osmdata-package-from-cran">Install and load OSMDATA package from CRAN</a></li>
  <li><a href="#visualize-valencia-city-map-using-openstreetmap-tutorial" id="toc-visualize-valencia-city-map-using-openstreetmap-tutorial" class="nav-link" data-scroll-target="#visualize-valencia-city-map-using-openstreetmap-tutorial">Visualize Valencia city map using OpenStreetMap tutorial</a></li>
  <li><a href="#select-your-reagion-and-add-one-feature" id="toc-select-your-reagion-and-add-one-feature" class="nav-link" data-scroll-target="#select-your-reagion-and-add-one-feature">1. Select your reagion and add one feature</a></li>
  <li><a href="#choosing-elements-for-map-first-layer" id="toc-choosing-elements-for-map-first-layer" class="nav-link" data-scroll-target="#choosing-elements-for-map-first-layer">2. Choosing elements for map first layer</a></li>
  <li><a href="#building-maps-in-layers-by-adding-natural-and-urban-features" id="toc-building-maps-in-layers-by-adding-natural-and-urban-features" class="nav-link" data-scroll-target="#building-maps-in-layers-by-adding-natural-and-urban-features">3. Building maps in layers by adding natural and urban features</a>
  <ul class="collapse">
  <li><a href="#initial-valencia-city-map-showing-roads-and-highways" id="toc-initial-valencia-city-map-showing-roads-and-highways" class="nav-link" data-scroll-target="#initial-valencia-city-map-showing-roads-and-highways">3.1 Initial Valencia city map showing roads and highways</a></li>
  <li><a href="#valencia-city-map-including-roads-and-coastline" id="toc-valencia-city-map-including-roads-and-coastline" class="nav-link" data-scroll-target="#valencia-city-map-including-roads-and-coastline">3.2 Valencia city map including roads and coastline</a></li>
  <li><a href="#new-water-bodies-features-added-to-valencia-city-map" id="toc-new-water-bodies-features-added-to-valencia-city-map" class="nav-link" data-scroll-target="#new-water-bodies-features-added-to-valencia-city-map">3.3 New Water bodies features added to Valencia city map</a></li>
  <li><a href="#including-specific-feature-by-name-in-the-map" id="toc-including-specific-feature-by-name-in-the-map" class="nav-link" data-scroll-target="#including-specific-feature-by-name-in-the-map">3.4 Including specific feature by name in the map</a></li>
  </ul></li>
  <li><a href="#combining-all-features-into-a-single-map-and-applying-specific-theme" id="toc-combining-all-features-into-a-single-map-and-applying-specific-theme" class="nav-link" data-scroll-target="#combining-all-features-into-a-single-map-and-applying-specific-theme">4. Combining all features into a single map and applying specific Theme</a></li>
  <li><a href="#save-output-map" id="toc-save-output-map" class="nav-link" data-scroll-target="#save-output-map">5. Save output map</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">City maps using OpenStreetMap R package</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Pablo Leon </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">March 14, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="creating-city-maps-using-osmdata-package" class="level2">
<h2 class="anchored" data-anchor-id="creating-city-maps-using-osmdata-package">Creating city maps using <strong>osmdata</strong> package</h2>
<p>This is a project to build maps with global open access mapping data using OSMDATA package in R.</p>
<p><a href="https://docs.ropensci.org/osmdata/articles/osmdata.html" class="uri">https://docs.ropensci.org/osmdata/articles/osmdata.html</a>.</p>
<p>In the package website, they explain that working with open access map data, ensures transparent data provenance and ownership, allowing anyone to contribute, encouraging democratic decision making and citizen science. OSM is a global open access mapping project, which is free and open under the ODbL licence (OpenStreetMap contributors 2017)</p>
</section>
<section id="working-with-vector-data" class="level2">
<h2 class="anchored" data-anchor-id="working-with-vector-data">Working with vector data</h2>
<p>OpenStreetMap (OSM) project information can be accessed via overpassqueries using <strong>osmdata</strong> package in R. This package obtain OSM data from the overpass API, which is a read-only API that serves up custom selected parts of the the OSM map data.</p>
</section>
<section id="install-and-load-osmdata-package-from-cran" class="level2">
<h2 class="anchored" data-anchor-id="install-and-load-osmdata-package-from-cran">Install and load OSMDATA package from CRAN</h2>
<p>To start working with Open OpenStreetMap package, install it from CRAN</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("osmdata",dependencies = TRUE)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>And then load it the usual way</p>
<div class="cell">

</div>
<p>From osmdata package we will use these functions to plot our map:</p>
<ul>
<li>getbb(): Get bounding box for a given place name</li>
<li>available_features(): List recognized features in OpenStreetMap(OSM)</li>
<li>available_features(): List recognized features in OSM. This function returns a character vector of all known features</li>
<li>available_tags(): List tags associated with a feature</li>
</ul>
<p>Once we know which features and tags we want to include in our map, we can start building the query to the API to retrieve these features</p>
<ul>
<li>opq(): Build an Overpass query</li>
<li>add_osm_feature(): Add a feature to an Overpass query. We specify the feature we want to plot and within that feature, we can also include a set of tags to be plotted in the map. As in the example below, we might want to plot <strong>“highway”</strong> feature in the map, so we include it in the Overpass query, but also we can specify other tags within that feature such as <strong>““motorway”,“primary”,“secondary”,“tertiary”,“residential”,“living_street”,“unclassified”</strong> as we can see in the Valencia city map example.</li>
<li>osmdata_sf(): Return an OSM Overpass query as an osmdata object in sf format.</li>
</ul>
<p>The combination of the above three functions provides us with an object that ggplot() package can take in to create a map using the geom_sf() function.</p>
<p>In a nutshell, a sf object is a collection of simple features that includes attributes and geometries in the form of a data frame. It is a data frame (or tibble) with rows of features, columns of attributes, and a special geometry column that contains the spatial aspects of the features.</p>
<p>For a further explantion about sf objects, please refer to Jesse Sadler website: [sf objects]<a href="https://www.jessesadler.com/post/simple-feature-objects/#:~:text=At%20its%20most%20basic%2C%20an,spatial%20aspects%20of%20the%20features." class="uri">https://www.jessesadler.com/post/simple-feature-objects/#:~:text=At%20its%20most%20basic%2C%20an,spatial%20aspects%20of%20the%20features.</a></p>
<p>Load also extra libraries for data wrangling and to create plots</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(here,tidyverse,osmdata,sf,showtext)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The <code>echo: false</code> option disables the printing of code (only output is displayed).</p>
</section>
<section id="visualize-valencia-city-map-using-openstreetmap-tutorial" class="level2">
<h2 class="anchored" data-anchor-id="visualize-valencia-city-map-using-openstreetmap-tutorial">Visualize Valencia city map using OpenStreetMap tutorial</h2>
<p>When building maps using OpenStreetMap, we can think about them in similar terms as ggplot2 plots, in the sense we build them step by step, adding one layer at a time to display the required information on top of the initial map of the region we want to create a map from.</p>
<p>Having selected the city we want to plot, then we use getbb() function to obtain a bounding box for a given place name. In this instance I will plot the city of Valencia in Spain.</p>
<p>getbb() provides latitude and longitude coordinates associated with Valencia city in Spain</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">getbb</span>(<span class="st">"Valencia Spain"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>         min        max
x -0.4325512 -0.2725205
y 39.2784496 39.5666089</code></pre>
</div>
</div>
</section>
<section id="select-your-reagion-and-add-one-feature" class="level2">
<h2 class="anchored" data-anchor-id="select-your-reagion-and-add-one-feature">1. Select your reagion and add one feature</h2>
<p>Now that I want to plot a map of Valencia I need to choose which features do I want to plot. Each feature is defined by a key and each key is sub-divided into further values.</p>
<p>For example, if I want to start plotting <em>roads</em> or highways into my map, I need to first identify how roads are defined in osmdata package. For that we use available_features() function to choose different roads or transportation routes defined in the map</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">available_features</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  [1] "4wd_only"                    "abandoned"                  
  [3] "abutters"                    "access"                     
  [5] "addr"                        "addr:city"                  
  [7] "addr:conscriptionnumber"     "addr:country"               
  [9] "addr:county"                 "addr:district"              
 [11] "addr:flats"                  "addr:full"                  
 [13] "addr:hamlet"                 "addr:housename"             
 [15] "addr:housenumber"            "addr:inclusion"             
 [17] "addr:interpolation"          "addr:place"                 
 [19] "addr:postbox"                "addr:postcode"              
 [21] "addr:province"               "addr:state"                 
 [23] "addr:street"                 "addr:subdistrict"           
 [25] "addr:suburb"                 "addr:unit"                  
 [27] "admin_level"                 "aeroway"                    
 [29] "agricultural"                "alt_name"                   
 [31] "amenity"                     "area"                       
 [33] "atv"                         "backward"                   
 [35] "barrier"                     "basin"                      
 [37] "bdouble"                     "bicycle"                    
 [39] "bicycle_road"                "biergarten"                 
 [41] "boat"                        "border_type"                
 [43] "boundary"                    "brand"                      
 [45] "bridge"                      "building"                   
 [47] "building:colour"             "building:fireproof"         
 [49] "building:flats"              "building:levels"            
 [51] "building:material"           "building:min_level"         
 [53] "building:part"               "building:soft_storey"       
 [55] "bus_bay"                     "busway"                     
 [57] "capacity"                    "castle_type"                
 [59] "change"                      "charge"                     
 [61] "clothes"                     "construction"               
 [63] "construction#Railways"       "covered"                    
 [65] "craft"                       "crossing"                   
 [67] "crossing:island"             "cuisine"                    
 [69] "cutting"                     "cycleway"                   
 [71] "denomination"                "destination"                
 [73] "diet:*"                      "direction"                  
 [75] "dispensing"                  "disused"                    
 [77] "drinking_water"              "drive_in"                   
 [79] "drive_through"               "ele"                        
 [81] "electric_bicycle"            "electrified"                
 [83] "embankment"                  "embedded_rails"             
 [85] "emergency"                   "end_date"                   
 [87] "entrance"                    "est_width"                  
 [89] "fee"                         "female"                     
 [91] "fire_object:type"            "fire_operator"              
 [93] "fire_rank"                   "foot"                       
 [95] "footway"                     "ford"                       
 [97] "forestry"                    "forward"                    
 [99] "frequency"                   "fuel"                       
[101] "gauge"                       "golf_cart"                  
[103] "goods"                       "hazard"                     
[105] "hazmat"                      "healthcare"                 
[107] "healthcare:counselling"      "healthcare:speciality"      
[109] "height"                      "hgv"                        
[111] "highway"                     "historic"                   
[113] "horse"                       "hot_water"                  
[115] "ice_road"                    "incline"                    
[117] "industrial"                  "inline_skates"              
[119] "inscription"                 "int_name"                   
[121] "internet_access"             "junction"                   
[123] "kerb"                        "landuse"                    
[125] "lanes"                       "lanes:bus"                  
[127] "lanes:psv"                   "layer"                      
[129] "leaf_cycle"                  "leaf_type"                  
[131] "leisure"                     "lhv"                        
[133] "lit"                         "loc_name"                   
[135] "location"                    "male"                       
[137] "man_made"                    "max_age"                    
[139] "max_level"                   "maxaxleload"                
[141] "maxheight"                   "maxlength"                  
[143] "maxspeed"                    "maxstay"                    
[145] "maxweight"                   "maxwidth"                   
[147] "military"                    "min_age"                    
[149] "min_level"                   "minspeed"                   
[151] "mofa"                        "moped"                      
[153] "motor_vehicle"               "motorboat"                  
[155] "motorcar"                    "motorcycle"                 
[157] "motorroad"                   "mountain_pass"              
[159] "mtb:description"             "mtb:scale"                  
[161] "name"                        "name_1"                     
[163] "name_2"                      "name:left"                  
[165] "name:right"                  "narrow"                     
[167] "nat_name"                    "natural"                    
[169] "noexit"                      "nudism"                     
[171] "office"                      "official_name"              
[173] "old_name"                    "oneway"                     
[175] "opening_hours"               "opening_hours:drive_through"
[177] "operator"                    "orientation"                
[179] "oven"                        "overtaking"                 
[181] "parking"                     "parking:condition"          
[183] "parking:lane"                "passing_places"             
[185] "place"                       "power"                      
[187] "power_supply"                "priority"                   
[189] "priority_road"               "produce"                    
[191] "proposed"                    "protected_area"             
[193] "psv"                         "public_transport"           
[195] "railway"                     "railway:preserved"          
[197] "railway:track_ref"           "recycling_type"             
[199] "ref"                         "reg_name"                   
[201] "religion"                    "rental"                     
[203] "residential"                 "roadtrain"                  
[205] "route"                       "sac_scale"                  
[207] "sauna"                       "service"                    
[209] "service_times"               "shelter_type"               
[211] "shop"                        "short_name"                 
[213] "shower"                      "sidewalk"                   
[215] "site"                        "ski"                        
[217] "smoothness"                  "social_facility"            
[219] "sorting_name"                "speed_pedelec"              
[221] "start_date"                  "step_count"                 
[223] "substation"                  "surface"                    
[225] "tactile_paving"              "tank"                       
[227] "tidal"                       "toilets"                    
[229] "toilets:wheelchair"          "toll"                       
[231] "topless"                     "tourism"                    
[233] "tracks"                      "tracktype"                  
[235] "traffic_calming"             "traffic_sign"               
[237] "trail_visibility"            "trailblazed"                
[239] "trailblazed:visibility"      "tunnel"                     
[241] "turn"                        "type"                       
[243] "unisex"                      "usage"                      
[245] "vehicle"                     "vending"                    
[247] "voltage"                     "water"                      
[249] "wheelchair"                  "wholesale"                  
[251] "width"                       "winter_road"                
[253] "wood"                       </code></pre>
</div>
</div>
<p>From the above list of features I can see “highway” as available key, so now I need to know which specific values are linked to that key. For tha I will use available_tags() function, to find out which values are related to the key “highway”</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">available_tags</span>(<span class="st">"highway"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "bridleway"              "bus_guideway"           "bus_stop"              
 [4] "busway"                 "construction"           "corridor"              
 [7] "crossing"               "cycleway"               "elevator"              
[10] "emergency_access_point" "emergency_bay"          "escape"                
[13] "footway"                "give_way"               "living_street"         
[16] "milestone"              "mini_roundabout"        "motorway"              
[19] "motorway_junction"      "motorway_link"          "passing_place"         
[22] "path"                   "pedestrian"             "platform"              
[25] "primary"                "primary_link"           "proposed"              
[28] "raceway"                "residential"            "rest_area"             
[31] "road"                   "secondary"              "secondary_link"        
[34] "service"                "services"               "speed_camera"          
[37] "steps"                  "stop"                   "street_lamp"           
[40] "tertiary"               "tertiary_link"          "toll_gantry"           
[43] "track"                  "traffic_mirror"         "traffic_signals"       
[46] "trailhead"              "trunk"                  "trunk_link"            
[49] "turning_circle"         "turning_loop"           "unclassified"          
[52] "via_ferrata"           </code></pre>
</div>
</div>
<p>As I want to start by plotting the main roads in the city of Valencia, i will choose a handful of the above tags: motorway, primary, secondary, tertiary,residential,living_street, unclassified.</p>
</section>
<section id="choosing-elements-for-map-first-layer" class="level2">
<h2 class="anchored" data-anchor-id="choosing-elements-for-map-first-layer">2. Choosing elements for map first layer</h2>
<p>We name each layer with the key and values we want to plot in the map. So for this first example, I want to see several types of roads in the region of Valencia</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># MAP LAYER 01: roads  </span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>roads <span class="ot">&lt;-</span> <span class="fu">getbb</span>(<span class="st">"Valencia Spain"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>         <span class="fu">opq</span>(<span class="at">timeout =</span>  <span class="dv">3500</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>         <span class="fu">add_osm_feature</span>(<span class="at">key =</span> <span class="st">"highway"</span>,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">value =</span> <span class="fu">c</span>(<span class="st">"motorway"</span>,<span class="st">"primary"</span>,<span class="st">"secondary"</span>,<span class="st">"tertiary"</span>,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"residential"</span>,<span class="st">"living_street"</span>,<span class="st">"unclassified"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>         <span class="fu">osmdata_sf</span>()</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>roads</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="building-maps-in-layers-by-adding-natural-and-urban-features" class="level2">
<h2 class="anchored" data-anchor-id="building-maps-in-layers-by-adding-natural-and-urban-features">3. Building maps in layers by adding natural and urban features</h2>
<section id="initial-valencia-city-map-showing-roads-and-highways" class="level3">
<h3 class="anchored" data-anchor-id="initial-valencia-city-map-showing-roads-and-highways">3.1 Initial Valencia city map showing roads and highways</h3>
<p>Using ggplot2, we use the sf cartographic object we queried from the OpenMap API, mapping several sf objects via ggplot2 and geom_sf() functions.</p>
<p>Also, It is in this step where we make use of getbb(“Valencia Spain”) function, to ensure the features we match the specific latitude and longitude of the city we want to plot.</p>
<p>We have created so far just one geom_sf() object, we include it within the ggplot() function alongside the lat and long coordinated of Valencia.</p>
<p>Prior to producing the final map, we define the color palette for each new feature</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remember to enclose Hexadecimal colors in apostrophes </span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>road_color <span class="ot">&lt;-</span> <span class="st">'#000000'</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>coastline_color <span class="ot">&lt;-</span> <span class="st">'#000000'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Then we can combine all previous scripts to create our first map</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>Valencia_roads_map <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">geom_sf</span>(<span class="at">data =</span> roads<span class="sc">$</span>osm_lines,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">color =</span> road_color</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>                            ) <span class="sc">+</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>                  <span class="co"># Define city coordinates for maps. Given by getbb("Valencia Spain") function</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.4325512</span>, <span class="sc">-</span><span class="fl">0.2725205</span>),</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>                           <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">39.2784496</span>, <span class="fl">39.5666089</span>),</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>                           <span class="at">expand =</span> <span class="cn">FALSE</span>)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>Valencia_roads_map</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Valencia_open_street_map_files/figure-html/Valencia%20road%20map-1.png" class="img-fluid" width="1440"></p>
</div>
</div>
</section>
<section id="valencia-city-map-including-roads-and-coastline" class="level3">
<h3 class="anchored" data-anchor-id="valencia-city-map-including-roads-and-coastline">3.2 Valencia city map including roads and coastline</h3>
<p>We now include a new feature to our map, this time we want to map the coastline and natural water features int he Valencia region.</p>
<p>We start by choosing the relevant key feature labelled as “natural” and browse different water related tags to be included in our map.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">available_tags</span>(<span class="st">"natural"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "arch"          "arete"         "bare_rock"     "bay"          
 [5] "beach"         "blowhole"      "cape"          "cave_entrance"
 [9] "cliff"         "coastline"     "crevasse"      "dune"         
[13] "earth_bank"    "fell"          "fumarole"      "geyser"       
[17] "glacier"       "grassland"     "heath"         "hill"         
[21] "hot_spring"    "isthmus"       "moor"          "mud"          
[25] "peak"          "peninsula"     "reef"          "ridge"        
[29] "rock"          "saddle"        "sand"          "scree"        
[33] "scrub"         "shingle"       "shoal"         "shrubbery"    
[37] "sinkhole"      "spring"        "stone"         "strait"       
[41] "tree"          "tree_row"      "tundra"        "valley"       
[45] "volcano"       "water"         "wetland"       "wood"         </code></pre>
</div>
</div>
<p>At a first glance, we can use those tabs related to coastal geological features such as “bay”,“water”,“beach”,“wetland” and “dune”. Let’s create a new object to include all these tags.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>Vlc_coastline <span class="ot">&lt;-</span> <span class="fu">getbb</span>(<span class="st">"Valencia Spain"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">opq</span>(<span class="at">timeout =</span>  <span class="dv">3500</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">add_osm_feature</span>(<span class="at">key =</span> <span class="st">"natural"</span>,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">value =</span> <span class="fu">c</span>(<span class="st">"bay"</span>,<span class="st">"water"</span>,<span class="st">"beach"</span>,<span class="st">"wetland"</span>,<span class="st">"dune"</span>,<span class="st">"coastline"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">osmdata_sf</span>()</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>Vlc_coastline</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>In order to display the sea bay in front of Valencia we define it as multipolygons object</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>Vlc_coastline_multipolygons <span class="ot">&lt;-</span> Vlc_coastline<span class="sc">$</span>osm_multipolygons</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We can create now a new map that will combine both coastline and road features</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>road_color <span class="ot">&lt;-</span> <span class="st">'#1E212B'</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>coastline_color <span class="ot">&lt;-</span> <span class="st">'#D4B483'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>This is a new map that will combine roads and coastline layers</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>Valencia_coastline_map <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>                  <span class="co"># roads</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">geom_sf</span>(<span class="at">data =</span> roads<span class="sc">$</span>osm_lines,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>,</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">color =</span> road_color</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>                            ) <span class="sc">+</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>                  <span class="co"># coastline as multipolygons</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">geom_sf</span>(<span class="at">data =</span> Vlc_coastline_multipolygons,</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>                          <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>,</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>                          <span class="at">color =</span> coastline_color</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>                            ) <span class="sc">+</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>                 <span class="co"># Define city coordinates for maps. Given by getbb("Valencia Spain") function</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.4325512</span>, <span class="sc">-</span><span class="fl">0.2725205</span>),</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>                           <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">39.2784496</span>, <span class="fl">39.5666089</span>),</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>                           <span class="at">expand =</span> <span class="cn">FALSE</span>)</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>Valencia_coastline_map</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Valencia_open_street_map_files/figure-html/Valencia%20coastline%20roads%20map-1.png" class="img-fluid" width="1440"></p>
</div>
</div>
</section>
<section id="new-water-bodies-features-added-to-valencia-city-map" class="level3">
<h3 class="anchored" data-anchor-id="new-water-bodies-features-added-to-valencia-city-map">3.3 New Water bodies features added to Valencia city map</h3>
<p>We want to include the see and different water bodies such as reservoirs and natural lagoons in the map, in the South part of the City of Valencia ther is a big lagoon called “La Albufera” we want to display it in hues of blue colors.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>Vlc_water <span class="ot">&lt;-</span> <span class="fu">getbb</span>(<span class="st">"Valencia Spain"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">opq</span>(<span class="at">timeout =</span>  <span class="dv">3500</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">add_osm_feature</span>(<span class="at">key =</span> <span class="st">"water"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">osmdata_sf</span>()</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>Vlc_sea <span class="ot">&lt;-</span> <span class="fu">getbb</span>(<span class="st">"Valencia Spain"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">opq</span>(<span class="at">timeout =</span>  <span class="dv">3500</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">add_osm_feature</span>(<span class="at">key =</span> <span class="st">"waterway"</span>,</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">value =</span> <span class="st">"river"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">osmdata_sf</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Define these two new water features as polygons</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>Vlc_water_multipolygons <span class="ot">&lt;-</span> Vlc_water<span class="sc">$</span>osm_multipolygons</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>Vlc_sea_multipolygons <span class="ot">&lt;-</span> Vlc_sea<span class="sc">$</span>osm_multipolygons</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Then we can add these two new layers of water features to the existing map Define first two new colours for water features</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>water_color <span class="ot">&lt;-</span> <span class="st">'#0066CC'</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>waterway_color <span class="ot">&lt;-</span> <span class="st">'#99CCFF'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Now we can produce a new map with the new water layers added to it.</p>
<p>First we group all colour palettes uses on each feature on this new map</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>road_color <span class="ot">&lt;-</span> <span class="st">'#1E212B'</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>coastline_color <span class="ot">&lt;-</span> <span class="st">'#D4B483'</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>water_color <span class="ot">&lt;-</span> <span class="st">'#0066CC'</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>waterway_color <span class="ot">&lt;-</span> <span class="st">'#99CCFF'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>Valencia_waterways_map <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>                  <span class="co"># roads</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">geom_sf</span>(<span class="at">data =</span> roads<span class="sc">$</span>osm_lines,</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">color =</span> road_color</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>                            ) <span class="sc">+</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># coastline as multipolygons</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">geom_sf</span>(<span class="at">data =</span> Vlc_coastline_multipolygons,</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>                          <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>,</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>                          <span class="at">color =</span> coastline_color</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>                            ) <span class="sc">+</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>                  <span class="co"># water colour as multipolygons</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">geom_sf</span>(<span class="at">data =</span> Vlc_water_multipolygons,</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>                          <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>,</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>                          <span class="at">color =</span> water_color</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>                            ) <span class="sc">+</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>                  <span class="co"># waterway colour as multipolygons</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_sf</span>(<span class="at">data =</span> Vlc_sea_multipolygons,</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>                          <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>,</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>                          <span class="at">color =</span> waterway_color</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>                            ) <span class="sc">+</span></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Define city coordinates for maps. Given by getbb("Valencia Spain") function</span></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.4325512</span>, <span class="sc">-</span><span class="fl">0.2725205</span>),</span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>                           <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">39.2784496</span>, <span class="fl">39.5666089</span>),</span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>                           <span class="at">expand =</span> <span class="cn">FALSE</span>)</span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>Valencia_waterways_map                    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Valencia_open_street_map_files/figure-html/Valencia%20coastline%20-1.png" class="img-fluid" width="1440"></p>
</div>
</div>
</section>
<section id="including-specific-feature-by-name-in-the-map" class="level3">
<h3 class="anchored" data-anchor-id="including-specific-feature-by-name-in-the-map">3.4 Including specific feature by name in the map</h3>
<p>This new map layer provides us with an efficient way of locating specific geological features by its common name. In this example I will include the l’Albufera freshwater lagoon. It is the largest freshwater lagoon in Spain, spanning more than 2,800 hectares.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>Albufera_lagoon  <span class="ot">&lt;-</span> <span class="fu">getbb</span>(<span class="st">"Valencia Spain"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">opq</span>(<span class="at">timeout =</span>  <span class="dv">3500</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">add_osm_feature</span>(<span class="at">key =</span> <span class="st">"natural"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">add_osm_feature</span>(<span class="at">key =</span> <span class="st">"name"</span>, <span class="at">value =</span> <span class="st">"l'Albufera"</span>, <span class="at">value_exact =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">osmdata_sf</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Again we define this lagoon as a polygon object in the map</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We choose multipolygons from shapefile to be plotted in the map </span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>Albufera_multipolygons <span class="ot">&lt;-</span> Albufera_lagoon<span class="sc">$</span>osm_multipolygons</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Specific geological feature included by name in the map</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>road_color <span class="ot">&lt;-</span> <span class="st">'#1E212B'</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>coastline_color <span class="ot">&lt;-</span> <span class="st">'#D4B483'</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>water_color <span class="ot">&lt;-</span> <span class="st">'#0066CC'</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>waterway_color <span class="ot">&lt;-</span> <span class="st">'#99CCFF'</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>albufera_lagoon <span class="ot">&lt;-</span> <span class="st">"#0ACDFF"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>Valencia_lagoon_map <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>                  <span class="co"># roads</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">geom_sf</span>(<span class="at">data =</span> roads<span class="sc">$</span>osm_lines,<span class="at">inherit.aes =</span> <span class="cn">FALSE</span>,<span class="at">color =</span> road_color) <span class="sc">+</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>                  <span class="co"># coastline</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">geom_sf</span>(<span class="at">data =</span> Vlc_coastline_multipolygons,<span class="at">inherit.aes =</span> <span class="cn">FALSE</span>, <span class="at">fill =</span> waterway_color, <span class="at">color =</span> waterway_color) <span class="sc">+</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>                  <span class="co"># water colour as multipolygons</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">geom_sf</span>(<span class="at">data =</span> Vlc_water_multipolygons,<span class="at">inherit.aes =</span> <span class="cn">FALSE</span>, <span class="at">fill =</span> water_color, <span class="at">color =</span> water_color) <span class="sc">+</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>                  <span class="co"># waterway colour as multipolygons</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">geom_sf</span>(<span class="at">data =</span> Vlc_sea_multipolygons,<span class="at">inherit.aes =</span> <span class="cn">FALSE</span>, <span class="at">fill =</span> waterway_color, <span class="at">color =</span> waterway_color) <span class="sc">+</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>                  <span class="co"># Adding l'Albufera lagoon to the map</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">geom_sf</span>(<span class="at">data =</span> Albufera_multipolygons,<span class="at">inherit.aes =</span> <span class="cn">FALSE</span>, <span class="at">fill =</span> albufera_lagoon, <span class="at">color =</span> albufera_lagoon) <span class="sc">+</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Define city coordinates for maps. Given by getbb("Valencia Spain") function</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.4325512</span>, <span class="sc">-</span><span class="fl">0.2725205</span>),<span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">39.2784496</span>, <span class="fl">39.5666089</span>),<span class="at">expand =</span> <span class="cn">FALSE</span>)</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>Valencia_lagoon_map  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Valencia_open_street_map_files/figure-html/Valencia%20lagoon%20map-1.png" class="img-fluid" width="2700"></p>
</div>
</div>
</section>
</section>
<section id="combining-all-features-into-a-single-map-and-applying-specific-theme" class="level1">
<h1>4. Combining all features into a single map and applying specific Theme</h1>
<p>Now that we have defined several features to be plotted in our map (roads,coastline,waterways and rivers), we can combine them all into an output map. Again we add each of these feature using the geom_sf() function.</p>
<p>This final step also includes making the map prettier by applying several theme options and adding a backgroud colour to the map as well as Title and Subtitle:</p>
<ul>
<li>Include Map title and subtitle</li>
<li>Setup background colour</li>
<li>Set map margins</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>road_color <span class="ot">&lt;-</span> <span class="st">'#1E212B'</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>coastline_color <span class="ot">&lt;-</span> <span class="st">'#D4B483'</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>water_color <span class="ot">&lt;-</span> <span class="st">'#0066CC'</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>waterway_color <span class="ot">&lt;-</span> <span class="st">'#99CCFF'</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>albufera_lagoon <span class="ot">&lt;-</span> <span class="st">"#0ACDFF"</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>font_color <span class="ot">&lt;-</span><span class="st">'#D2691E'</span> </span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>background_color <span class="ot">&lt;-</span> <span class="st">"#D4B483"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>Valencia_city_map <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>                  <span class="co"># roads</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">geom_sf</span>(<span class="at">data =</span> roads<span class="sc">$</span>osm_lines,<span class="at">inherit.aes =</span> <span class="cn">FALSE</span>,<span class="at">color =</span> road_color) <span class="sc">+</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>                  <span class="co"># coastline</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">geom_sf</span>(<span class="at">data =</span> Vlc_coastline_multipolygons,<span class="at">inherit.aes =</span> <span class="cn">FALSE</span>, <span class="at">fill =</span> waterway_color, <span class="at">color =</span> waterway_color) <span class="sc">+</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>                  <span class="co"># water colour as multipolygons</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">geom_sf</span>(<span class="at">data =</span> Vlc_water_multipolygons,<span class="at">inherit.aes =</span> <span class="cn">FALSE</span>, <span class="at">fill =</span> water_color, <span class="at">color =</span> water_color) <span class="sc">+</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>                  <span class="co"># waterway colour as multipolygons</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">geom_sf</span>(<span class="at">data =</span> Vlc_sea_multipolygons,<span class="at">inherit.aes =</span> <span class="cn">FALSE</span>, <span class="at">fill =</span> waterway_color, <span class="at">color =</span> waterway_color) <span class="sc">+</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>                  <span class="co"># Adding l'Albufera lagoon to the map</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">geom_sf</span>(<span class="at">data =</span> Albufera_multipolygons,<span class="at">inherit.aes =</span> <span class="cn">FALSE</span>, <span class="at">fill =</span> albufera_lagoon, <span class="at">color =</span> albufera_lagoon) <span class="sc">+</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Define city coordinates for maps. Given by getbb("Valencia Spain") function</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.4325512</span>, <span class="sc">-</span><span class="fl">0.2725205</span>),<span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">39.2784496</span>, <span class="fl">39.5666089</span>),<span class="at">expand =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Include Map title and subtitle </span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Valencia ~ l'Albufera"</span>, <span class="at">subtitle =</span> <span class="st">'39.4699° N, 0.3763° W'</span>) <span class="sc">+</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Apply specific theme to map title and sub-title</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"Barlow"</span>,<span class="at">color =</span> font_color,<span class="at">size =</span> <span class="dv">9</span>, </span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>                              <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="dv">1</span>),</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title.position =</span> <span class="st">"plot"</span>,</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"Barlow"</span>,</span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">color =</span> font_color,</span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">size =</span> <span class="dv">5</span>,</span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">hjust =</span> <span class="dv">0</span> , <span class="at">vjust =</span> <span class="fl">2.3</span>),  </span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Setup background color for entire map </span></span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">colour =</span> background_color, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">size =</span> <span class="dv">1</span>),</span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="fl">0.6</span>,<span class="fl">1.6</span>,<span class="dv">1</span>,<span class="fl">1.6</span>),<span class="st">"cm"</span>),</span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> background_color)</span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a>Valencia_city_map </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Valencia_open_street_map_files/figure-html/Valencia%20city%20map-1.png" class="img-fluid" width="2700"></p>
</div>
</div>
</section>
<section id="save-output-map" class="level1">
<h1>5. Save output map</h1>
<p>The last step of this <strong>OpenStreetMap (OSM)</strong> using <strong>osmdata R package</strong> tutorial is to save the map image created as a .png file, so we can print or distribute it.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Output map file name "Valencia Albufera feshwater lagoon"</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>name <span class="ot">&lt;-</span> <span class="st">"Valencia_open_street_map"</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>width <span class="ot">=</span> <span class="dv">20</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>height <span class="ot">=</span> <span class="dv">40</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Save chart</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="fu">paste</span>(name,<span class="st">".png"</span>, <span class="at">sep =</span><span class="st">"_"</span>)),</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">device =</span> <span class="st">"png"</span>, <span class="at">width =</span> width, <span class="at">height =</span> height, <span class="at">units =</span> <span class="st">"cm"</span>, <span class="at">dpi =</span> <span class="st">"retina"</span>, <span class="at">bg =</span> <span class="st">"transparent"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Script used to produce this map called “Valencia_street_map” can be found here:</p>
<ul>
<li>Valencia open street map: https://github.com/Pablo-source/Maps-in-R/tree/main/City_maps/Valencia_open_street_map.R</li>
</ul>
</section>
<section id="references" class="level1">
<h1>References</h1>
<ul>
<li>Open Street Map data website: https://rspatialdata.github.io/osm.html</li>
<li>OSM osmdata package GitHub repo: https://github.com/ropensci/osmdata</li>
<li>GGPLOT2 pacakge: https://ggplot2.tidyverse.org/</li>
</ul>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>